!function($,e,t,i){var n=function(){};n.prototype={setup:function(e){return this.defaults={preload:{},options:{sectionSelector:".imm-section",transition:"default",updateNav:!0,breakpoints:{mobile:480,tablet:768,mdDesktop:992,lgDesktop:1200},muteButton:{unmuted:"Audio On",muted:"Audio Off"}},sections:[]},this.setup=$.extend(!0,this.defaults,e),this},init:function(e,t){this.elem=e,this.$elem=$(e),this.setup=t.setup,this.assets=this.setup.assets,this.sections=[],this._isScrolling=!1,this._canScroll=!0;var i=this;this.utils.deviceView.init.call(this);var n=this.utils.assets.register.call(this,this);return this.controllers.section.call(this,this),this.controllers.scroll.init.call(this,this),this.controllers.navigation.init.call(this,this),this.controllers.audio.init.call(this,this),$.when(n).then(function(e){console.log("Assets loaded"),$.each(i.sections,function(e,t){$(t.element).trigger("init")}),$(".imm-loading").hide()},function(e){alert("Asset loading failed")}),this},controllers:{section:function(e){var t=$(this.setup.options.sectionSelector);$.each(t,function(t,i){var n=$(i).hasClass("imm-fullscreen")?!1:!0,o={name:$(i)[0].id,element:$(i),updateNav:e.setup.options.updateNav,transition:e.setup.options.transition,hideFromNav:!1,unbindScroll:n};e.sections.push(o)}),$.each(this.setup.sections,function(t,i){var n=$(i.element);$.each(e.sections,function(t,n){e.sections[t]=$(n.element)[0]===$(i.element)[0]?i:n}),$.each(i.animations,function(t,i){e.controllers.animation.call(e,n,t,i)}),$.each(i.actions,function(t,i){e.controllers.action.call(e,n,t,i)}),$.each(i.attributes,function(t,i){e.controllers.attribute.call(e,n,t,i)});var o=n.find("[data-imm-video]");$.each(o,function(t,n){e.controllers.video.init.call(e,i,$(n))})}),$.each(this.sections,function(t,i){e.controllers.scroll.scrollOffset.set.call(e,i)}),this.sections.sort(function(e,t){return e.scrollOffset-t.scrollOffset})},animation:function(e,t,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=new TimelineMax({paused:!0}),o=i.timeline(e),s=isNaN(i.delay)?null:i.delay,l,r,c=this;null!==s&&n.set({},{},"+="+s),n.add(o),$.each(i.runtime,function(e,t){l=l+" "+t}),$.each(i.reset,function(e,t){r=r+" "+t}),e.on(l,function(){console.log("Running "+t),n.play()}),e.on(r,function(){console.log("Resetting "+t),n.pause(0,!0)})},action:function(e,t,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=i.action,o=isNaN(i.delay)?0:i.delay,s,l=this;$.each(i.runtime,function(e,t){s=s+" "+t}),e.on(s,function(){setTimeout(function(){n.call(l,e)},o)})},attribute:function(e,t,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=i.value,o=isNaN(i.delay)?0:i.delay,s,l=this;$.each(i.runtime,function(e,t){s=s+" "+t}),e.on(s,function(){setTimeout(function(){l.$elem.trigger(t,n)},o)})},scroll:{init:function(t){this._scrollContainer=$($(this.elem)[0]===$("body")[0]?e:this.elem),this._currentSection=this.sections[0],this._sectionBelow=this.sections[1],this._scrollContainer.scrollTop(0),this._scrollUnbound=this._currentSection.unbindScroll?!0:!1,this.controllers.scroll.initHandlers.call(this),this.$elem.on("sectionChanged",function(e,i){t._scrollUnbound=i.current.unbindScroll?!0:!1,t.controllers.scroll.initHandlers.call(t)}),this.controllers.touch.init.call(this)},initHandlers:function(){this._scrollContainer.on("mousewheel wheel DOMMouseScroll",this.controllers.scroll.handler.bind(this)),$(t).on("keydown",this.controllers.scroll.keydownHandler.bind(this)),$(t).on("keyup",this.controllers.scroll.keyupHandler.bind(this))},browserScroll:function(i,n){function o(t){t=t||e.event,t.preventDefault&&t.preventDefault(),t.returnValue=!1}"enable"===i?(e.removeEventListener&&e.removeEventListener("DOMMouseScroll",o,!1),e.onmousewheel=t.onmousewheel=null,e.onwheel=null,e.ontouchmove=null):"disable"===i&&(e.addEventListener&&e.addEventListener("DOMMouseScroll",o,!1),e.onwheel=o,e.onmousewheel=t.onmousewheel=o,e.ontouchmove=o)},handler:function(e){this._scrollUnbound?(this.controllers.scroll.browserScroll("enable",e),this.controllers.scroll.detectUnboundSectionChange.call(this,e)):(this.controllers.scroll.browserScroll("disable",e),e.originalEvent.wheelDelta>=0?this.controllers.scroll.ifCanThenGo.call(this,"UP"):this.controllers.scroll.ifCanThenGo.call(this,"DOWN"))},detectUnboundSectionChange:function(t){var i=this._scrollContainer.scrollTop()<=this._currentSection.scrollOffset,n=this._sectionBelow.unbindScroll===!1?this._sectionBelow.scrollOffset-$(e).height():this._sectionBelow.scrollOffset,o=this._scrollContainer.scrollTop()>=n;if(i){if(this.utils.isScrollEvent(t)&&t.originalEvent.wheelDelta<0)return;if(this.utils.isKeydownEvent(t)&&38!==t.which)return;this._sectionAbove.unbindScroll||(t.preventDefault(),this._scrollUnbound=!1,this.controllers.scroll.ifCanThenGo.call(this,"UP"))}else if(o){if(this.utils.isScrollEvent(t)&&t.originalEvent.wheelDelta>=0)return;if(this.utils.isKeydownEvent(t)&&40!==t.which)return;this._sectionBelow.unbindScroll||(t.preventDefault(),this._scrollUnbound=!1,this.controllers.scroll.ifCanThenGo.call(this,"DOWN"))}},keyupHandler:function(e){this._lastKey=null},keydownHandler:function(e){if(!this._scrollUnbound&&this._lastKey&&this._lastKey.which==e.which)return void e.preventDefault();switch(this._lastKey=e,e.which){case 38:this._scrollUnbound?this.controllers.scroll.detectUnboundSectionChange.call(this,e):(e.preventDefault(),this.controllers.scroll.ifCanThenGo.call(this,"UP"));break;case 40:this._scrollUnbound?this.controllers.scroll.detectUnboundSectionChange.call(this,e):(e.preventDefault(),this.controllers.scroll.ifCanThenGo.call(this,"DOWN"));break;default:return}},ifCanThenGo:function(e){this._isScrolling===!1&&this._canScroll===!0&&(this._isScrolling=!0,this.controllers.scroll.go.call(this,e))},go:function(t){var n,o,s,l=this._currentSection,r=this.sections.indexOf(l),c,a=$(l.element),u=this;if(t.jquery?(n=$.grep(this.sections,function(e){return t[0].id==e.element[0].id})[0],s=l.scrollOffset>n.scrollOffset?"UP":"DOWN"):("UP"===t||"DOWN"===t)&&(s=t,n="UP"===s?this.sections[r-1]:this.sections[r+1]),"UP"===s?o={exiting:"exitingUp",entering:"enteringUp",exited:"exitedUp",entered:"enteredUp"}:"DOWN"===s&&(o={exiting:"exitingDown",entering:"enteringDown",exited:"exitedDown",entered:"enteredDown"}),n===i)return this._isScrolling=!1,this._canScroll=!0,!1;c=u.sections.indexOf(n),this._sectionAbove=this.sections[c-1],this._sectionBelow=this.sections[c+1];var h=$(n.element),d=n.scrollOffset;a.trigger(o.exiting),h.trigger(o.entering),"UP"===s&&n.unbindScroll===!0&&(d="-="+$(e).height()),this.$elem.animate({scrollTop:d},1e3,function(){h.trigger(o.entered),a.trigger(o.exited),u._lastSection=l,u._currentSection=n,u.$elem.trigger("sectionChanged",[{last:u._lastSection,current:u._currentSection,below:u._sectionBelow,above:u._sectionAbove}]),setTimeout(function(){u._isScrolling=!1,u._canScroll=!0},500)})},scrollOffset:{set:function(e){e.scrollOffset=$(e.element).offset().top},update:function(){var e=this;$.each(this.sections,function(t,i){e.controllers.scroll.scrollOffset.set.call(e,i)})}},stickySection:function(){if(!this._scrollUnbound){var e=this._currentSection.scrollOffset;this._scrollContainer.scrollTop(e)}}},touch:{init:function(){this.controllers.touch.recognize.call(this),this.controllers.touch.handler.call(this)},recognize:function(){var e=$.support.touch,t="touchmove scroll",n=e?"touchstart":"mousedown",o=e?"touchend":"mouseup",s=e?"touchmove":"mousemove";$.event.special.swipeupdown={setup:function(){var e=this,t=$(e);t.bind(n,function(e){function n(e){if(r){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e;c={time:(new Date).getTime(),coords:[t.pageX,t.pageY]},Math.abs(r.coords[1]-c.coords[1])>10&&e.preventDefault()}}var l=e.originalEvent.touches?e.originalEvent.touches[0]:e,r={time:(new Date).getTime(),coords:[l.pageX,l.pageY],origin:$(e.target)},c;t.bind(s,n).one(o,function(e){t.unbind(s,n),r&&c&&c.time-r.time<1e3&&Math.abs(r.coords[1]-c.coords[1])>30&&Math.abs(r.coords[0]-c.coords[0])<75&&r.origin.trigger("swipeupdown").trigger(r.coords[1]>c.coords[1]?"swipeup":"swipedown"),r=c=i})})}},$.each({swipedown:"swipeupdown",swipeup:"swipeupdown"},function(e,t){$.event.special[e]={setup:function(){$(this).bind(t,$.noop)}}})},handler:function(){var e=this;$(t).on("swipedown swipeup",function(t){switch(t.type){case"swipedown":e.controllers.scroll.ifCanThenGo.call(e,"UP");break;case"swipeup":e.controllers.scroll.ifCanThenGo.call(e,"DOWN");break;default:return}})}},navigation:{init:function(e){this.controllers.navigation.addToDOM.call(this);var t=$('.imm-nav-list li a[data-imm-section="#'+this._currentSection.element[0].id+'"]');e.controllers.navigation.update.call(e,t),$(".imm-nav-list li a").on("click",function(){var t=$($(this).data("imm-section"));e.controllers.scroll.ifCanThenGo.call(e,t),e.controllers.navigation.update.call(e,$(this))}),this.$elem.on("sectionChanged",function(t,i){var n=$('.imm-nav-list li a[data-imm-section="#'+i.current.element[0].id+'"]');e.controllers.navigation.update.call(e,n)})},addToDOM:function(){var e=$(".imm-nav-list");if(0===e.length)return!1;var t="";$.each(this.sections,function(e,i){i.hideFromNav||(t=t+'<li>\n                            <a class="imm-nav-link" data-imm-section="#'+i.element[0].id+'">\n                              <span>'+i.name+"</span>\n                            </a>\n                          </li>")}),e.html(t)},update:function(e){$(".imm-nav-list li a").removeClass("current"),e!==i&&e.addClass("current")}},audio:{all:[],playing:[],init:function(e){this.controllers.audio.muteBtns.init.call(this),this.controllers.audio.handleChange.call(this,this,this._currentSection.audio),this.$elem.on("sectionChanged",function(t,i){e.controllers.audio.handleChange.call(e,e,i.current.audio)}),this.controllers.audio.handleBlurFocus.call(this)},handleChange:function(e,t){if(this._muted)return!1;this.controllers.audio.playing=[],this.controllers.audio.start.call(this,t);var i=this.controllers.audio.all.filter(function(t){return-1===$.inArray(t,e.controllers.audio.playing)});this.controllers.audio.mute.call(this,i)},start:function(e){var t=this;e!==i&&$.each(e,function(e,i){var n=$("audio#"+e),o=isNaN(i.delay)?0:i.delay;t.controllers.audio.playing.push(e),n[0].paused&&(n[0].volume=0,n[0].play()),TweenMax.to(n,i.changeDuration,{volume:i.volume,ease:Linear.easeNone,delay:o})})},mute:function(e){$.each(e,function(e,t){var i=$("audio#"+t);TweenMax.to(i,1,{volume:0,ease:Linear.easeNone,onComplete:function(){i[0].pause(),i[0].currentTime=0}})})},muteBtns:{init:function(){var e=this;this.controllers.audio.$muteBtns=this.$elem.find(".imm-mute"),"muted"===this.utils.cookies.get("immAudioState")?this.controllers.audio.muteBtns.change.call(this,"off"):this.controllers.audio.muteBtns.change.call(this,"on"),this.controllers.audio.$muteBtns.on("click",function(){e.controllers.audio.muteBtns.click.call(e)})},change:function(e){var t;"off"===e?(t=this.setup.options.muteButton.muted,this.controllers.audio.$muteBtns.addClass("imm-muted").html(t),this._muted=!0):(t=this.setup.options.muteButton.unmuted,this.controllers.audio.$muteBtns.removeClass("imm-muted").html(t),this._muted=!1)},click:function(){if(this._muted){var e=this._currentSection.audio;this.controllers.audio.start.call(this,e),this.controllers.audio.muteBtns.change.call(this,"on"),this.utils.cookies.set.call(this,"immAudioState","",3650)}else{var t=this.controllers.audio.playing;this.controllers.audio.mute.call(this,t),this.controllers.audio.muteBtns.change.call(this,"off"),this.utils.cookies.set.call(this,"immAudioState","muted",3650)}}},handleBlurFocus:function(){var t=this;$(e).on("blur",function(){var e=t.controllers.audio.playing;t._muted||t.controllers.audio.mute.call(t,e)}),$(e).on("focus",function(){var e=t._currentSection.audio;t._muted||t.controllers.audio.start.call(t,e)})}},video:{init:function(e,t){if(this._isMobile)return!1;var i=t.find("video"),n=$(e.element),o=this;n.on("init enteringDown enteringUp",function(n){("init"!==n.type||e.element===o._currentSection.element)&&(i.css({visibility:"hidden"}).one("canplaythrough",function(){o.controllers.video.resize.call(o,t,i)}).one("playing",function(){i.css("visibility","visible"),t.css("background-image","none")}),i[0].paused&&(i[0].play(),o.controllers.video.resize.call(o,t,i)))}),n.on("exitedDown exitedUp",function(){i[0].paused||(i[0].pause(),i[0].currentTime=0)})},resizeAll:function(){var e=this;$.each(this.$elem.find("[data-imm-video]"),function(t,i){var n=$(i),o=n.find("video");e.controllers.video.resize.call(e,n,o)})},resize:function(e,t){var i=$(e),n=$(t),o=n[0].videoHeight,s=n[0].videoWidth,l=i.height(),r=i.width();r/s>l/o?n.css({width:r+2,height:"auto"}):n.css({width:"auto",height:l+2})}}},utils:{deviceView:{init:function(){this._windowWidth=$(e).width(),this._windowHeight=$(e).height(),this.utils.deviceView.set.call(this,this._windowWidth),this.utils.deviceView.resize.call(this,this)},set:function(e){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|OperaMini/i.test(navigator.userAgent),i=480>=e;t||i?(this._device="mobile",this._isMobile=!0,this._isDesktop=!1):(this._device="desktop",this._isMobile=!1,this._isDesktop=!0)},resize:function(t){this._windowWidth=$(e).width(),this._windowHeight=$(e).height(),$(e).on("resize",function(){t.utils.deviceView.set.call(t,t._windowWidth),t.controllers.scroll.scrollOffset.update.call(t),t.controllers.scroll.stickySection.call(t),t._isMobile||t.controllers.video.resizeAll.call(t)})},check:function(e){var t=-1!==$.inArray("mobile",e.devices),i=-1!==$.inArray("desktop",e.devices);return t&&!i&&!this._isMobile||i&&!t&&!this._isDesktop?!1:void 0}},isScrollEvent:function(e){return"wheel"===e.type||"DOMMouseScroll"===e.type||"mousewheel"===e.type},isKeydownEvent:function(e){return"keydown"===e.type},cookies:{set:function(e,i,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var s="expires="+o.toGMTString();t.cookie=e+"="+i+"; "+s},get:function(e){for(var i=e+"=",n=t.cookie.split(";"),o=0;o<n.length;o++){for(var s=n[o];" "==s.charAt(0);)s=s.substring(1);if(-1!=s.indexOf(i))return s.substring(i.length,s.length)}return""},"delete":function(e){this.utils.cookies.set.call(this,e,"",-1)}},assets:{register:function(e){var t=jQuery.Deferred(),i=[],n,o=function(){0===i.length&&(t.resolve("loaded"),clearTimeout(n))};return $.each(this.assets,function(t,n){if("audio"===n.type&&e.utils.assets.addToDOM.audio.call(e,t,n),"video"===n.type&&e.utils.assets.addToDOM.video.call(e,t,n),n.wait===!0){if(n.error)return void console.log("Asset Failure: Could not preload "+n.type+" asset '"+t+"'");i.push({name:t,asset:n})}}),$.each(i,function(e,t){var n=t.name,t=t.asset;if(("audio"===t.type||"video"===t.type)&&$(t.type+"#"+n)[0].addEventListener("canplaythrough",function(){i.splice($.inArray(t,i),1),o()},!1),"image"===t.type){var s=$.isArray(t.fileTypes)?t.fileTypes:["jpg"],l=jQuery.Deferred(),r=function(){0===s.length&&l.resolve("loaded")};$.each(s,function(e,i){var n=new Image;n.src=t.path+"."+i,n.onload=function(){s.splice($.inArray(i,s),1),r()}}),l.done(function(){i.splice($.inArray(t,i),1),o()})}}),o(),n=setTimeout(function(){t.reject("problem")},1e4),t.promise()},addToDOM:{audio:function(e,t){if(t.path===i)return console.log("Asset Error: Must define a path for audio asset '"+e+"'"),t.error=!0,!1;var n=1==t.loop?"loop":"",o=$.isArray(t.fileTypes)?t.fileTypes:["mp3"],s="";return $.each(o,function(e,i){s=s+'<source src="'+t.path+"."+i+'" type="audio/'+i+'">'}),this.$elem.append('<audio id="'+e+'" class="imm-audio" '+n+">"+s+"</audio>"),this.controllers.audio.all.push(e),!0},video:function(e,t){if(t.path===i)return console.log("Asset Error: Must define a path for video asset '"+e+"'"),t.error=!0,!1;var n=this.$elem.find('[data-imm-video="'+e+'"]'),o=$.isArray(t.fileTypes)?t.fileTypes:["mp4","ogv","webm"],s=t.loop===!1?"":'loop="loop" ',l="";if(n.css("background-image","url("+t.path+".jpg)"),this._isMobile)return!1;$.each(o,function(e,i){l=l+'<source src="'+t.path+"."+i+'" type="video/'+i+'">'});var r=$("<video "+s+">"+l+"</video>");n.append(r)}}},extendSection:function(e,t){var i={name:t.element[0].id,animations:{},actions:{},attributes:{},updateNav:e.defaults.options.updateNav,transition:e.defaults.options.transition,hideFromNav:!1,unbindScroll:!1},t=$.extend(!0,i,t);return e.setup.sections.push(t),t}}},$.Immerse={page:{setup:function(e){return new n(this).setup(e)}},section:{setup:function(e,t){return new n(this).utils.extendSection(e,t)}},init:function(e,t){new n(this).init(e,t)}}}(jQuery,window,document);
//# sourceMappingURL=./immerse.min.js.map