!function($,t,e,i){var o=function(){};o.prototype={setup:function(t){return this.defaults={preload:{},options:{sectionSelector:".imm-section",transition:"default",updateNav:!0,breakpoints:{mobile:480,tablet:768,mdDesktop:992,lgDesktop:1200},muteButton:{unmuted:"Audio On",muted:"Audio Off"}},sections:[]},this.setup=$.extend(!0,this.defaults,t),this},init:function(t,e){this.elem=t,this.$elem=$(t),this.setup=e.setup,this.assets=this.setup.assets,this.sections=[];var i=this;return this.utils.deviceView.init.call(this),this.utils.assets.register.call(this,this),this.controllers.section.call(this,this),this.controllers.scroll.init.call(this,this),this.controllers.navigation.init.call(this,this),this.controllers.audio.init.call(this,this),$.each(this.sections,function(t,e){$(e.element).trigger("init")}),this},controllers:{section:function(t){var e=$(this.setup.options.sectionSelector);$.each(e,function(e,i){var o=$(i).hasClass("imm-fullscreen")?!1:!0,n={name:$(i)[0].id,element:$(i),updateNav:t.setup.options.updateNav,transition:t.setup.options.transition,hideFromNav:!1,unbound:o};t.sections.push(n)}),$.each(this.setup.sections,function(e,i){var o=$(i.element);$.each(t.sections,function(e,o){t.sections[e]=$(o.element)[0]===$(i.element)[0]?i:o}),$.each(i.animations,function(e,i){t.controllers.animation.call(t,o,e,i)}),$.each(i.actions,function(e,i){t.controllers.action.call(t,o,e,i)}),$.each(i.attributes,function(e,i){t.controllers.attribute.call(t,o,e,i)});var n=o.find("[data-imm-video]");$.each(n,function(e,o){t.controllers.video.init.call(t,i,$(o))})}),$.each(this.sections,function(e,i){t.controllers.scroll.scrollOffset.set.call(t,i)}),this.sections.sort(function(t,e){return t.scrollOffset-e.scrollOffset})},animation:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var o=new TimelineMax({paused:!0}),n=i.timeline(t),l=isNaN(i.delay)?null:i.delay,s,r,c=this;null!==l&&o.set({},{},"+="+l),o.add(n),$.each(i.runtime,function(t,e){s=s+" "+e}),$.each(i.reset,function(t,e){r=r+" "+e}),t.on(s,function(){console.log("Running "+e),o.play()}),t.on(r,function(){console.log("Resetting "+e),o.pause(0,!0)})},action:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var o=i.action,n=isNaN(i.delay)?0:i.delay,l,s=this;$.each(i.runtime,function(t,e){l=l+" "+e}),t.on(l,function(){setTimeout(function(){o.call(s,t)},n)})},attribute:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var o=i.value,n=isNaN(i.delay)?0:i.delay,l,s=this;$.each(i.runtime,function(t,e){l=l+" "+e}),t.on(l,function(){setTimeout(function(){s.$elem.trigger(e,o)},n)})},scroll:{isScrolling:!1,canScroll:!0,unbound:!1,init:function(i){this.scrollContainer=$($(this.elem)[0]===$("body")[0]?t:this.elem),this.controllers.scroll.currentSection=this.sections[0],this.scrollContainer.scrollTop(0),this.scrollContainer.bind("mousewheel wheel DOMMouseScroll",function(t){i.controllers.scroll.handler.call(i,t)}),$(e).keydown(function(t){i.controllers.scroll.keydownHandler.call(i,t)}),$(e).keyup(function(t){i.controllers.scroll.lastKey=null}),this.controllers.touch.handler.call(this)},scrollOffset:{set:function(t){t.scrollOffset=$(t.element).offset().top},update:function(){var t=this;$.each(this.sections,function(e,i){t.controllers.scroll.scrollOffset.set.call(t,i)})}},stickySection:function(){var t=this.controllers.scroll.currentSection.scrollOffset;this.scrollContainer.scrollTop(t)},status:function(i,o){function n(e){e=e||t.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}"enable"===i?(t.removeEventListener&&t.removeEventListener("DOMMouseScroll",n,!1),t.onmousewheel=e.onmousewheel=null,t.onwheel=null,t.ontouchmove=null):"disable"===i&&(t.addEventListener&&t.addEventListener("DOMMouseScroll",n,!1),t.onwheel=n,t.onmousewheel=e.onmousewheel=n,t.ontouchmove=n)},handler:function(t){this.controllers.scroll.status("disable",t),this.controllers.scroll.isScrolling===!1&&this.controllers.scroll.canScroll===!0&&(this.controllers.scroll.isScrolling=!0,t.originalEvent.wheelDelta>=0?this.controllers.scroll.go.call(this,"UP"):this.controllers.scroll.go.call(this,"DOWN"))},keydownHandler:function(t){if(this.controllers.scroll.lastKey&&this.controllers.scroll.lastKey.which==t.which)return void t.preventDefault();switch(this.controllers.scroll.lastKey=t,t.which){case 38:t.preventDefault(),this.controllers.scroll.isScrolling===!1&&this.controllers.scroll.canScroll===!0&&(this.controllers.scroll.isScrolling=!0,this.controllers.scroll.go.call(this,"UP"));break;case 40:t.preventDefault(),this.controllers.scroll.isScrolling===!1&&this.controllers.scroll.canScroll===!0&&(this.controllers.scroll.isScrolling=!0,this.controllers.scroll.go.call(this,"DOWN"));break;default:return}},go:function(t){var e,o,n,l=this.controllers.scroll.currentSection,s=this.sections.indexOf(l),r=$(l.element),c=this;if(t.jquery?(e=$.grep(this.sections,function(e){return t[0].id==e.element[0].id})[0],n=l.scrollOffset>e.scrollOffset?"UP":"DOWN"):("UP"===t||"DOWN"===t)&&(n=t,e="UP"===n?this.sections[s-1]:this.sections[s+1]),"UP"===n?o={exiting:"exitingUp",entering:"enteringUp",exited:"exitedUp",entered:"enteredUp"}:"DOWN"===n&&(o={exiting:"exitingDown",entering:"enteringDown",exited:"exitedDown",entered:"enteredDown"}),e===i)return c.controllers.scroll.isScrolling=!1,c.controllers.scroll.canScroll=!0,!1;var a=$(e.element),u=e.scrollOffset;r.trigger(o.exiting),a.trigger(o.entering),this.$elem.animate({scrollTop:u},1e3,function(){a.trigger(o.entered),r.trigger(o.exited),c.$elem.trigger("sectionChanged",[{prev:l,current:e}]),c.controllers.scroll.currentSection=e,setTimeout(function(){c.controllers.scroll.isScrolling=!1,c.controllers.scroll.canScroll=!0},500)})}},touch:{handler:function(){var t=this;$(e).on("touchstart touchmove touchend",function(e){switch(e.type){case"touchstart":t.controllers.touch.startY=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY,t.controllers.touch.startTime=new Date;break;case"touchmove":break;case"touchend":t.controllers.touch.endY=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY,t.controllers.touch.swipeDuration=new Date-t.controllers.touch.startTime,alert(t.controllers.touch.swipeDuration)}})}},navigation:{init:function(t){this.controllers.navigation.addToDOM.call(this);var e=$('.imm-nav-list li a[data-imm-section="#'+this.controllers.scroll.currentSection.element[0].id+'"]');t.controllers.navigation.update.call(t,e),$(".imm-nav-list li a").on("click",function(){var e=$($(this).data("imm-section"));t.controllers.scroll.go.call(t,e),t.controllers.navigation.update.call(t,$(this))}),this.$elem.on("sectionChanged",function(e,i){var o=$('.imm-nav-list li a[data-imm-section="#'+i.current.element[0].id+'"]');t.controllers.navigation.update.call(t,o)})},addToDOM:function(){var t=$(".imm-nav-list");if(0===t.length)return!1;var e="";$.each(this.sections,function(t,i){i.hideFromNav||(e=e+'<li>\n                            <a class="imm-nav-link" data-imm-section="#'+i.element[0].id+'">\n                              <span>'+i.name+"</span>\n                            </a>\n                          </li>")}),t.html(e)},update:function(t){$(".imm-nav-list li a").removeClass("current"),t!==i&&t.addClass("current")}},audio:{all:[],playing:[],muted:!1,init:function(t){this.controllers.audio.muteBtns.init.call(this),this.controllers.audio.handleChange.call(this,this,this.controllers.scroll.currentSection.audio),this.$elem.on("sectionChanged",function(e,i){t.controllers.audio.handleChange.call(t,t,i.current.audio)}),this.controllers.audio.handleBlurFocus.call(this)},handleChange:function(t,e){if(this.controllers.audio.muted)return!1;this.controllers.audio.playing=[],this.controllers.audio.start.call(this,e);var i=this.controllers.audio.all.filter(function(e){return-1===$.inArray(e,t.controllers.audio.playing)});this.controllers.audio.mute.call(this,i)},start:function(t){var e=this;t!==i&&$.each(t,function(t,i){var o=$("audio#"+t),n=isNaN(i.delay)?0:i.delay;e.controllers.audio.playing.push(t),o[0].paused&&(o[0].volume=0,o[0].play()),TweenMax.to(o,i.changeDuration,{volume:i.volume,ease:Linear.easeNone,delay:n})})},mute:function(t){$.each(t,function(t,e){var i=$("audio#"+e);TweenMax.to(i,1,{volume:0,ease:Linear.easeNone,onComplete:function(){i[0].pause(),i[0].currentTime=0}})})},muteBtns:{init:function(){var t=this;this.controllers.audio.$muteBtns=this.$elem.find(".imm-mute"),"muted"===this.utils.cookies.get("immAudioState")?this.controllers.audio.muteBtns.change.call(this,"off"):this.controllers.audio.muteBtns.change.call(this,"on"),this.controllers.audio.$muteBtns.on("click",function(){t.controllers.audio.muteBtns.click.call(t)})},change:function(t){var e;"off"===t?(e=this.setup.options.muteButton.muted,this.controllers.audio.$muteBtns.addClass("imm-muted").html(e),this.controllers.audio.muted=!0):(e=this.setup.options.muteButton.unmuted,this.controllers.audio.$muteBtns.removeClass("imm-muted").html(e),this.controllers.audio.muted=!1)},click:function(){if(this.controllers.audio.muted){var t=this.controllers.scroll.currentSection.audio;this.controllers.audio.start.call(this,t),this.controllers.audio.muteBtns.change.call(this,"on"),this.utils.cookies.set.call(this,"immAudioState","",3650)}else{var e=this.controllers.audio.playing;this.controllers.audio.mute.call(this,e),this.controllers.audio.muteBtns.change.call(this,"off"),this.utils.cookies.set.call(this,"immAudioState","muted",3650)}}},handleBlurFocus:function(){var e=this;$(t).on("blur",function(){var t=e.controllers.audio.playing;e.controllers.audio.muted||e.controllers.audio.mute.call(e,t)}),$(t).on("focus",function(){var t=e.controllers.scroll.currentSection.audio;e.controllers.audio.muted||e.controllers.audio.start.call(e,t)})}},video:{init:function(t,e){var i=e.find("video"),o=$(t.element),n=this;o.on("init enteringDown enteringUp",function(o){("init"!==o.type||t.element===n.controllers.scroll.currentSection.element)&&(i.css({visibility:"hidden"}).one("canplaythrough",function(){n.controllers.video.resize.call(n,e,i)}).one("playing",function(){i.css("visibility","visible"),e.css("background-image","none")}),i[0].paused&&(i[0].play(),n.controllers.video.resize.call(n,e,i)))}),o.on("exitedDown exitedUp",function(){i[0].paused||(i[0].pause(),i[0].currentTime=0)})},resizeAll:function(){var t=this;$.each(this.$elem.find("[data-imm-video]"),function(e,i){var o=$(i),n=o.find("video");t.controllers.video.resize.call(t,o,n)})},resize:function(t,e){var i=$(t),o=$(e),n=o[0].videoHeight,l=o[0].videoWidth,s=i.height(),r=i.width();r/l>s/n?o.css({width:r+2,height:"auto"}):o.css({width:"auto",height:s+2})}}},utils:{deviceView:{init:function(){this.windowWidth=$(t).width(),this.windowHeight=$(t).height(),this.utils.deviceView.set.call(this,this.windowWidth),this.utils.deviceView.resize.call(this,this)},set:function(t){var e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|OperaMini/i.test(navigator.userAgent),i=480>=t;e||i?(this.device="mobile",this.isMobile=!0,this.isDesktop=!1):(this.device="desktop",this.isMobile=!1,this.isDesktop=!0)},resize:function(e){this.windowWidth=$(t).width(),this.windowHeight=$(t).height(),$(t).on("resize",function(){e.utils.deviceView.set.call(e,e.windowWidth),e.controllers.scroll.scrollOffset.update.call(e),e.controllers.scroll.stickySection.call(e),e.controllers.video.resizeAll.call(e)})},check:function(t){var e=-1!==$.inArray("mobile",t.devices),i=-1!==$.inArray("desktop",t.devices);return e&&!i&&!this.isMobile||i&&!e&&!this.isDesktop?!1:void 0}},cookies:{set:function(t,i,o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var l="expires="+n.toGMTString();e.cookie=t+"="+i+"; "+l},get:function(t){for(var i=t+"=",o=e.cookie.split(";"),n=0;n<o.length;n++){for(var l=o[n];" "==l.charAt(0);)l=l.substring(1);if(-1!=l.indexOf(i))return l.substring(i.length,l.length)}return""},"delete":function(t){this.utils.cookies.set.call(this,t,"",-1)}},assets:{register:function(t){$.each(this.assets,function(e,i){"audio"===i.type&&t.utils.assets.addToDOM.audio.call(t,e,i),"video"===i.type&&t.utils.assets.addToDOM.video.call(t,e,i)})},addToDOM:{audio:function(t,e){var i=1==e.loop?"loop":"",o=$.isArray(e.fileTypes)?e.fileTypes:["mp3"],n="";return $.each(o,function(t,i){n=n+'<source src="'+e.path+"."+i+'" type="audio/'+i+'">'}),this.$elem.append('<audio id="'+t+'" class="imm-audio" '+i+">"+n+"</audio>"),this.controllers.audio.all.push(t),!0},video:function(t,e){if(e.path===i)return console.log("Must define a path for video '"+t+"'"),!1;var o=this.$elem.find('[data-imm-video="'+t+'"]'),n=$.isArray(e.fileTypes)?e.fileTypes:["mp4","ogv","webm"],l=e.loop===!1?"":'loop="loop" ',s="";$.each(n,function(t,i){s=s+'<source src="'+e.path+"."+i+'" type="video/'+i+'">'});var r=$("<video "+l+">"+s+"</video>");o.append(r),o.css("background-image","url("+e.path+".jpg)")}}},extendSection:function(t,e){var i={name:e.element[0].id,animations:{},actions:{},attributes:{},updateNav:t.defaults.options.updateNav,transition:t.defaults.options.transition,hideFromNav:!1,unbound:!1},e=$.extend(!0,i,e);return t.setup.sections.push(e),e}}},$.Immerse={page:{setup:function(t){return new o(this).setup(t)}},section:{setup:function(t,e){return new o(this).utils.extendSection(t,e)}},init:function(t,e){new o(this).init(t,e)}}}(jQuery,window,document);
//# sourceMappingURL=./immerse.min.js.map