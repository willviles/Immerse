!function($,t,e,i){var n=function(){};n.prototype={setup:function(t){return this.defaults={preload:{},options:{sectionSelector:".imm-section",defaultTransition:{type:"scroll",duration:250},breakpoints:{mobile:480,tablet:768,mdDesktop:992,lgDesktop:1200},muteButton:{unmuted:"Audio On",muted:"Audio Off"}},sections:[]},this.setup=$.extend(!0,this.defaults,t),this},init:function(t){this.elem=t,this.$elem=$(t),this.assets=this.setup.assets,this.sections=[],this._isScrolling=!1,this._canScroll=!0;var e=this;this.utils.deviceView.init.call(this);var i=this.controllers.assets.register.call(this,this);return this.controllers.section.call(this,this),this.controllers.scroll.init.call(this,this),this.controllers.navigation.init.call(this,this),this.controllers.audio.init.call(this,this),$.when(i).then(function(t){console.log("Assets loaded"),$.each(e.sections,function(t,e){$(e.element).trigger("init")}),$(".imm-loading").hide()},function(t){alert("Asset loading failed")}),this},controllers:{section:function(t){var e=$(this.setup.options.sectionSelector);$.each(e,function(e,i){var n=$(i).hasClass("imm-fullscreen")?!1:!0,o=t.utils.stringify($(i)[0].id),s={name:o,element:$(i),updateNav:t.setup.options.updateNav,transition:t.setup.options.transition,options:{hideFromNav:!1,unbindScroll:n}};t.sections.push(s)}),$.each(this.setup.sections,function(e,i){var n=$(i.element);$.each(t.sections,function(e,n){t.sections[e]=$(n.element)[0]===$(i.element)[0]?i:n}),$.each(i.animations,function(e,i){t.controllers.animation.call(t,n,e,i)}),$.each(i.actions,function(e,i){t.controllers.action.call(t,n,e,i)}),$.each(i.attributes,function(e,i){t.controllers.attribute.call(t,n,e,i)});var o=n.find("[data-imm-video]");$.each(o,function(e,n){t.controllers.video.init.call(t,i,$(n))});var s=n.find("[data-imm-tooltip]");$.each(s,function(e,i){t.components.tooltips.init.call(t,$(i))})}),$.each(this.sections,function(e,i){t.controllers.scroll.scrollOffset.set.call(t,i)}),this.sections.sort(function(t,e){return t.scrollOffset-e.scrollOffset})},animation:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=new TimelineMax({paused:!0}),o=i.timeline(t),s=isNaN(i.delay)?null:i.delay,l,r,c=this;null!==s&&n.set({},{},"+="+s),n.add(o),$.each(i.runtime,function(t,e){l=l+" "+e}),$.each(i.reset,function(t,e){r=r+" "+e}),t.on(l,function(){console.log("Running "+e),n.play()}),t.on(r,function(){console.log("Resetting "+e),n.pause(0,!0)})},action:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=i.action,o=isNaN(i.delay)?0:i.delay,s,l=this;$.each(i.runtime,function(t,e){s=s+" "+e}),t.on(s,function(){setTimeout(function(){n.call(l,t)},o)})},attribute:function(t,e,i){if(this.utils.deviceView.check.call(this,i)===!1)return!1;var n=i.value,o=isNaN(i.delay)?0:i.delay,s,l=this;$.each(i.runtime,function(t,e){s=s+" "+e}),t.on(s,function(){setTimeout(function(){l.$elem.trigger(e,n)},o)})},scroll:{init:function(e){this._scrollContainer=$($(this.elem)[0]===$("body")[0]?t:this.elem),this._currentSection=this.sections[0],this._sectionBelow=this.sections[1],this._scrollContainer.scrollTop(0),this._scrollUnbound=this._currentSection.options.unbindScroll?!0:!1,this.controllers.scroll.initHandlers.call(this),this.$elem.on("sectionChanged",function(t,i){e._scrollUnbound=i.current.options.unbindScroll?!0:!1,e.controllers.scroll.initHandlers.call(e)}),this.controllers.touch.init.call(this)},initHandlers:function(){this._scrollContainer.on("mousewheel wheel DOMMouseScroll",this.controllers.scroll.handler.bind(this)),$(e).on("keydown",this.controllers.scroll.keydownHandler.bind(this)),$(e).on("keyup",this.controllers.scroll.keyupHandler.bind(this))},browserScroll:function(i,n){function o(e){e=e||t.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}"enable"===i?(t.removeEventListener&&t.removeEventListener("DOMMouseScroll",o,!1),t.onmousewheel=e.onmousewheel=null,t.onwheel=null,t.ontouchmove=null):"disable"===i&&(t.addEventListener&&t.addEventListener("DOMMouseScroll",o,!1),t.onwheel=o,t.onmousewheel=e.onmousewheel=o,t.ontouchmove=o)},handler:function(t){this._scrollUnbound?(this.controllers.scroll.browserScroll("enable",t),this.controllers.scroll.detectUnboundSectionChange.call(this,t)):(this.controllers.scroll.browserScroll("disable",t),t.originalEvent.wheelDelta>=0?this.controllers.scroll.ifCanThenGo.call(this,"UP"):this.controllers.scroll.ifCanThenGo.call(this,"DOWN"))},detectUnboundSectionChange:function(e){var i=this._scrollContainer.scrollTop()<=this._currentSection.scrollOffset,n=this._sectionBelow.options.unbindScroll===!1?this._sectionBelow.scrollOffset-$(t).height():this._sectionBelow.scrollOffset,o=this._scrollContainer.scrollTop()>=n;if(i){if(this.utils.isScrollEvent(e)&&e.originalEvent.wheelDelta<0)return;if(this.utils.isKeydownEvent(e)&&38!==e.which)return;this._sectionAbove.options.unbindScroll||(e.preventDefault(),this._scrollUnbound=!1,this.controllers.scroll.ifCanThenGo.call(this,"UP"))}else if(o){if(this.utils.isScrollEvent(e)&&e.originalEvent.wheelDelta>=0)return;if(this.utils.isKeydownEvent(e)&&40!==e.which)return;this._sectionBelow.options.unbindScroll||(e.preventDefault(),this._scrollUnbound=!1,this.controllers.scroll.ifCanThenGo.call(this,"DOWN"))}},keyupHandler:function(t){this._lastKey=null},keydownHandler:function(t){if(!this._scrollUnbound&&this._lastKey&&this._lastKey.which==t.which)return void t.preventDefault();switch(this._lastKey=t,t.which){case 38:this._scrollUnbound?this.controllers.scroll.detectUnboundSectionChange.call(this,t):(t.preventDefault(),this.controllers.scroll.ifCanThenGo.call(this,"UP"));break;case 40:this._scrollUnbound?this.controllers.scroll.detectUnboundSectionChange.call(this,t):(t.preventDefault(),this.controllers.scroll.ifCanThenGo.call(this,"DOWN"));break;default:return}},ifCanThenGo:function(t){this._isScrolling===!1&&this._canScroll===!0&&(this._isScrolling=!0,this.controllers.scroll.go.call(this,t))},go:function(e){var n,o,s,l,r=this._currentSection,c=this.sections.indexOf(r),a,u=$(r.element),h=this;if(e.jquery?(n=$.grep(this.sections,function(t){return e[0].id==t.element[0].id})[0],s=r.scrollOffset>n.scrollOffset?"UP":"DOWN"):("UP"===e||"DOWN"===e)&&(s=e,n="UP"===s?this.sections[c-1]:this.sections[c+1]),"UP"===s?o={exiting:"exitingUp",entering:"enteringUp",exited:"exitedUp",entered:"enteredUp"}:"DOWN"===s&&(o={exiting:"exitingDown",entering:"enteringDown",exited:"exitedDown",entered:"enteredDown"}),n===i)return this._isScrolling=!1,this._canScroll=!0,!1;a=h.sections.indexOf(n),this._sectionAbove=this.sections[a-1],this._sectionBelow=this.sections[a+1];var d=$(n.element),f=n.scrollOffset;u.trigger(o.exiting),d.trigger(o.entering),"UP"===s&&n.options.unbindScroll===!0&&(f="-="+$(t).height()),this.$elem.animate({scrollTop:f},1e3,function(){d.trigger(o.entered),u.trigger(o.exited),h._lastSection=r,h._currentSection=n,h.$elem.trigger("sectionChanged",[{last:h._lastSection,current:h._currentSection,below:h._sectionBelow,above:h._sectionAbove}]),setTimeout(function(){h._isScrolling=!1,h._canScroll=!0},500)})},scrollOffset:{set:function(t){t.scrollOffset=$(t.element).offset().top},update:function(){var t=this;$.each(this.sections,function(e,i){t.controllers.scroll.scrollOffset.set.call(t,i)})}},stickySection:function(){if(!this._scrollUnbound){var t=this._currentSection.scrollOffset;this._scrollContainer.scrollTop(t)}}},touch:{init:function(){this.controllers.touch.recognize.call(this),this.controllers.touch.handler.call(this)},recognize:function(){var t=$.support.touch,e="touchmove scroll",n=t?"touchstart":"mousedown",o=t?"touchend":"mouseup",s=t?"touchmove":"mousemove";$.event.special.swipeupdown={setup:function(){var t=this,e=$(t);e.bind(n,function(t){function n(t){if(r){var e=t.originalEvent.touches?t.originalEvent.touches[0]:t;c={time:(new Date).getTime(),coords:[e.pageX,e.pageY]},Math.abs(r.coords[1]-c.coords[1])>10&&t.preventDefault()}}var l=t.originalEvent.touches?t.originalEvent.touches[0]:t,r={time:(new Date).getTime(),coords:[l.pageX,l.pageY],origin:$(t.target)},c;e.bind(s,n).one(o,function(t){e.unbind(s,n),r&&c&&c.time-r.time<1e3&&Math.abs(r.coords[1]-c.coords[1])>30&&Math.abs(r.coords[0]-c.coords[0])<75&&r.origin.trigger("swipeupdown").trigger(r.coords[1]>c.coords[1]?"swipeup":"swipedown"),r=c=i})})}},$.each({swipedown:"swipeupdown",swipeup:"swipeupdown"},function(t,e){$.event.special[t]={setup:function(){$(this).bind(e,$.noop)}}})},handler:function(){var t=this;$(e).on("swipedown swipeup",function(e){switch(e.type){case"swipedown":t.controllers.scroll.ifCanThenGo.call(t,"UP");break;case"swipeup":t.controllers.scroll.ifCanThenGo.call(t,"DOWN");break;default:return}})}},navigation:{init:function(t){this.controllers.navigation.addToDOM.call(this);var e=$('.imm-nav-list li a[data-imm-section="#'+this._currentSection.element[0].id+'"]');t.controllers.navigation.update.call(t,e),$(".imm-nav-list li a").on("click",function(){var e=$($(this).data("imm-section"));t.controllers.scroll.ifCanThenGo.call(t,e)}),this.$elem.on("sectionChanged",function(e,i){var n=$('.imm-nav-list li a[data-imm-section="#'+i.current.element[0].id+'"]');t.controllers.navigation.update.call(t,n)})},addToDOM:function(){var t=$(".imm-nav-list");if(0===t.length)return!1;var e="";$.each(this.sections,function(t,i){i.options.hideFromNav||(e=e+'<li>\n                            <a class="imm-nav-link" data-imm-section="#'+i.element[0].id+'">\n                              <span>'+i.name+"</span>\n                            </a>\n                          </li>")}),t.html(e)},update:function(t){$(".imm-nav-list li a").removeClass("current"),t.length>0&&t.addClass("current")}},audio:{all:[],playing:[],init:function(t){this.controllers.audio.muteBtns.init.call(this),this.controllers.audio.handleChange.call(this,this,this._currentSection.audio),this.$elem.on("sectionChanged",function(e,i){t.controllers.audio.handleChange.call(t,t,i.current.audio)}),this.controllers.audio.handleBlurFocus.call(this)},handleChange:function(t,e){if(this._muted)return!1;this.controllers.audio.playing=[],this.controllers.audio.start.call(this,e);var i=this.controllers.audio.all.filter(function(e){return-1===$.inArray(e,t.controllers.audio.playing)});this.controllers.audio.mute.call(this,i)},start:function(t){var e=this;t!==i&&$.each(t,function(t,i){var n=$("audio#"+t),o=isNaN(i.delay)?0:i.delay;e.controllers.audio.playing.push(t),n[0].paused&&(n[0].volume=0,n[0].play()),TweenMax.to(n,i.changeDuration,{volume:i.volume,ease:Linear.easeNone,delay:o})})},mute:function(t){$.each(t,function(t,e){var i=$("audio#"+e);TweenMax.to(i,1,{volume:0,ease:Linear.easeNone,onComplete:function(){i[0].pause(),i[0].currentTime=0}})})},muteBtns:{init:function(){var t=this;this.controllers.audio.$muteBtns=this.$elem.find(".imm-mute"),"muted"===this.utils.cookies.get("immAudioState")?this.controllers.audio.muteBtns.change.call(this,"off"):this.controllers.audio.muteBtns.change.call(this,"on"),this.controllers.audio.$muteBtns.on("click",function(){t.controllers.audio.muteBtns.click.call(t)})},change:function(t){var e;"off"===t?(e=this.setup.options.muteButton.muted,this.controllers.audio.$muteBtns.addClass("imm-muted").html(e),this._muted=!0):(e=this.setup.options.muteButton.unmuted,this.controllers.audio.$muteBtns.removeClass("imm-muted").html(e),this._muted=!1)},muteAll:function(){var t=this.controllers.audio.playing;this.controllers.audio.mute.call(this,t),this.controllers.audio.muteBtns.change.call(this,"off"),this.utils.cookies.set.call(this,"immAudioState","muted",3650)},unmuteAll:function(){var t=this._currentSection.audio;this.controllers.audio.start.call(this,t),this.controllers.audio.muteBtns.change.call(this,"on"),this.utils.cookies.set.call(this,"immAudioState","",3650)},click:function(){this._muted?this.controllers.audio.muteBtns.unmuteAll.call(this):this.controllers.audio.muteBtns.muteAll.call(this)}},handleBlurFocus:function(){var e=this;$(t).on("blur",function(){var t=e.controllers.audio.playing;e._muted||e.controllers.audio.mute.call(e,t)}),$(t).on("focus",function(){var t=e._currentSection.audio;e._muted||e.controllers.audio.start.call(e,t)})}},video:{init:function(t,e){if(this._isMobile)return!1;var i=e.find("video"),n=$(t.element),o=this;n.on("init enteringDown enteringUp",function(n){("init"!==n.type||t.element===o._currentSection.element)&&(i.css({visibility:"hidden"}).one("canplaythrough",function(){o.controllers.video.resize.call(o,e,i)}).one("playing",function(){i.css("visibility","visible"),e.css("background-image","none")}),i[0].paused&&(i[0].play(),o.controllers.video.resize.call(o,e,i)))}),n.on("exitedDown exitedUp",function(){i[0].paused||(i[0].pause(),i[0].currentTime=0)})},resizeAll:function(){var t=this;$.each(this.$elem.find("[data-imm-video]"),function(e,i){var n=$(i),o=n.find("video");t.controllers.video.resize.call(t,n,o)})},resize:function(t,e){var i=$(t),n=$(e),o=n[0].videoHeight,s=n[0].videoWidth,l=i.height(),r=i.width();r/s>l/o?n.css({width:r+2,height:"auto"}):n.css({width:"auto",height:l+2})}},assets:{register:function(t){var e=jQuery.Deferred(),i=[],n,o=function(){0===i.length&&(e.resolve("loaded"),clearTimeout(n))};return $.each(this.assets,function(e,n){if("audio"===n.type&&t.controllers.assets.addToDOM.audio.call(t,e,n),"video"===n.type&&t.controllers.assets.addToDOM.video.call(t,e,n),n.wait===!0){if(n.error)return void console.log("Asset Failure: Could not preload "+n.type+" asset '"+e+"'");i.push({name:e,asset:n})}}),$.each(i,function(t,e){var n=e.name,e=e.asset;if(("audio"===e.type||"video"===e.type)&&$(e.type+"#"+n)[0].addEventListener("canplaythrough",function(){i.splice($.inArray(e,i),1),o()},!1),"image"===e.type){var s=$.isArray(e.fileTypes)?e.fileTypes:["jpg"],l=jQuery.Deferred(),r=function(){0===s.length&&l.resolve("loaded")};$.each(s,function(t,i){var n=new Image;n.src=e.path+"."+i,n.onload=function(){s.splice($.inArray(i,s),1),r()}}),l.done(function(){i.splice($.inArray(e,i),1),o()})}}),o(),n=setTimeout(function(){e.reject("problem")},1e4),e.promise()},addToDOM:{audio:function(t,e){if(e.path===i)return console.log("Asset Error: Must define a path for audio asset '"+t+"'"),e.error=!0,!1;var n=1==e.loop?"loop":"",o=$.isArray(e.fileTypes)?e.fileTypes:["mp3"],s="";return $.each(o,function(t,i){s=s+'<source src="'+e.path+"."+i+'" type="audio/'+i+'">'}),this.$elem.append('<audio id="'+t+'" class="imm-audio" '+n+">"+s+"</audio>"),this.controllers.audio.all.push(t),!0},video:function(t,e){if(e.path===i)return console.log("Asset Error: Must define a path for video asset '"+t+"'"),e.error=!0,!1;var n=this.$elem.find('[data-imm-video="'+t+'"]'),o=$.isArray(e.fileTypes)?e.fileTypes:["mp4","ogv","webm"],s=e.loop===!1?"":'loop="loop" ',l="";if(n.css("background-image","url("+e.path+".jpg)"),this._isMobile)return!1;$.each(o,function(t,i){l=l+'<source src="'+e.path+"."+i+'" type="video/'+i+'">'});var r=$("<video "+s+">"+l+"</video>");n.append(r)}}}},components:{tooltips:{init:function(t){var e=t.data("imm-tooltip"),e="#"===e.charAt(0)?$(e):e,e=e.jquery?$(e).html():e,i=this;$tContent=$('<span class="imm-tooltip">'+e+"</span>"),t.append($tContent),t.hover(function(){$tContent.removeClass("top left right bottom"),i.components.tooltips.position.call(i,t)},function(){$tContent.removeClass("top left right bottom")})},position:function(e){var i=e.find(".imm-tooltip"),n=i.height(),o=i.width(),s=e[0].getBoundingClientRect(),l="top";n>=s.top&&(l="bottom"),o/2>=s.left?l="right":o/2>=$(t).width()-s.right&&(l="left"),i.addClass(l)}}},utils:{deviceView:{init:function(){this._windowWidth=$(t).width(),this._windowHeight=$(t).height(),this.utils.deviceView.set.call(this,this._windowWidth),this.utils.deviceView.resize.call(this,this)},set:function(t){var e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|OperaMini/i.test(navigator.userAgent),i=480>=t;e||i?(this._device="mobile",this._isMobile=!0,this._isDesktop=!1):(this._device="desktop",this._isMobile=!1,this._isDesktop=!0)},resize:function(e){this._windowWidth=$(t).width(),this._windowHeight=$(t).height(),$(t).on("resize",function(){e.utils.deviceView.set.call(e,e._windowWidth),e.controllers.scroll.scrollOffset.update.call(e),e.controllers.scroll.stickySection.call(e),e._isMobile||e.controllers.video.resizeAll.call(e)})},check:function(t){var e=-1!==$.inArray("mobile",t.devices),i=-1!==$.inArray("desktop",t.devices);return e&&!i&&!this._isMobile||i&&!e&&!this._isDesktop?!1:void 0}},isScrollEvent:function(t){return"wheel"===t.type||"DOMMouseScroll"===t.type||"mousewheel"===t.type},isKeydownEvent:function(t){return"keydown"===t.type},stringify:function(t){return t.replace(/[-_]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase().replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},cookies:{set:function(t,i,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var s="expires="+o.toGMTString();e.cookie=t+"="+i+"; "+s},get:function(t){for(var i=t+"=",n=e.cookie.split(";"),o=0;o<n.length;o++){for(var s=n[o];" "==s.charAt(0);)s=s.substring(1);if(-1!=s.indexOf(i))return s.substring(i.length,s.length)}return""},"delete":function(t){this.utils.cookies.set.call(this,t,"",-1)}},extendSection:function(t){var e={name:t.element[0].id,animations:{},actions:{},attributes:{},updateNav:this.setup.options.updateNav,transition:this.setup.options.transition,options:{hideFromNav:!1,unbindScroll:!1}},t=$.extend(!0,e,t);return this.setup.sections.push(t),t}},section:function(t){return this.utils.extendSection.call(this,t)},audio:function(t){if("unmute"===t)this.controllers.audio.muteBtns.unmuteAll.call(this);else if("mute"===t)this.controllers.audio.muteBtns.muteAll.call(this);else if(t===i)return this._muted?!1:!0},changeSection:function(t){return t===i?!1:void this.controllers.scroll.ifCanThenGo.call(this,t)}},$.Immerse={setup:function(t){return new n(this).setup(t)}}}(jQuery,window,document);
//# sourceMappingURL=./immerse.min.js.map